#!/usr/bin/make -f

DEB_DESTDIR := debian/bluez-firmware

%:
	dh $@

override_dh_auto_configure:
	dh_auto_configure -- --libdir=/lib

override_dh_auto_install:
	dh_auto_install

	# Copy text files and LICENCE of Mecha-comet-m-gen1
	mkdir -p $(DEB_DESTDIR)/lib/firmware/brcm

	cp $(CURDIR)/broadcom-4533/broadcom/*.txt \
		$(DEB_DESTDIR)/lib/firmware/brcm/.
		
	cp $(CURDIR)/broadcom-4533/broadcom/LICENCE.broadcom_bcm43xx \
		$(DEB_DESTDIR)/lib/firmware/.

	cp $(CURDIR)/broadcom-4533/broadcom/brcmfmac43455-sdio.bin \
		$(DEB_DESTDIR)/lib/firmware/brcm/.

	cp $(CURDIR)/broadcom-4533/broadcom/brcmfmac43455-sdio.clm_blob \
	    $(DEB_DESTDIR)/lib/firmware/brcm/.	

	# Copy firmware of Mecha-comet-m-gen1
	mkdir -p $(DEB_DESTDIR)/etc/firmware
	cp $(CURDIR)/broadcom-4533/broadcom/*.hcd \
		$(DEB_DESTDIR)/etc/firmware/.

	# Copy regulatory.db files of Mecha-comet-m-gen1
	cp $(CURDIR)/broadcom-4533/broadcom/regulatory* \
		$(DEB_DESTDIR)/lib/firmware/.			

	# Copy hooks of Mecha-comet-m-gen1
	mkdir -p $(DEB_DESTDIR)/usr/share/initramfs-tools/hooks
	cp $(CURDIR)/broadcom-4533/initramfs-tools/hooks/* \
		$(DEB_DESTDIR)/usr/share/initramfs-tools/hooks/. 

	# Change permission of hooks
	chmod 755 $(DEB_DESTDIR)/usr/share/initramfs-tools/hooks/* 

